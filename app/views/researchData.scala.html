@* Copyright 2016 Jan Schnasse, hbz. Licensed under the GNU Affero General Public License *@ 

@(myForm:Form[models.ZettelModel],dataFormat:String,documentId:String,topicId:String,formType:String)
@import tags._ 
@import services._
@jsonMap=@{ZettelHelper.getJsonMap(myForm)}
@zettel("Bildungsmaterialien",myForm,dataFormat,documentId,topicId,formType) {
	@if(myForm.hasGlobalErrors) {
		<p class="error">@myForm.globalError.message</p>
	} 
	@helper.form(action = routes.ZettelController.postForm(ResearchData.id,dataFormat,documentId,topicId)){
		<a href="@models.ResearchData.getHelpTextUrl()" id="helpTextUrl" style="float:right" target="blank">Hilfe</a>
		@accordion(""){
			@accordionPanel(services.ZettelFields.titleHeaderZF.getLabel(),"title-section"){
			    @smallTextArea(myForm,"title","Titel des Materials"+"*","",1)
			}
			@accordionPanel(services.ZettelFields.creatorshipHeaderZF.getLabel(),"creator-section"){
                @contributorWidget(myForm,jsonMap)
                <br/>
                @creatorWidget(myForm,jsonMap)
			}
			
			@accordionPanel(services.ZettelFields.catalogingHeaderZF.getLabel(),"cataloging-section"){
				@textArea(myForm,"description",services.ZettelFields.descriptionZF.getLabel(),"",11)
			}
			@accordionPanel(services.ZettelFields.uploadHeaderZF.getLabel(),"upload-section"){
				@singleSelect(myForm,"license",services.ZettelFields.licenseZF.getLabel(),"select-licence",ResearchDataHelper.getLicenseMap(),17)
			}
			@accordionPanel(services.ZettelFields.catalogingHeaderZF.getLabel(),"cataloging-section"){
				@multicombobox(myForm,jsonMap,"department",services.ZettelFields.departmentZF.getLabel(),"select-department",ResearchDataHelper.getDepartmentMap(),18)
			}
			@accordionPanel(services.ZettelFields.catalogingHeaderZF.getLabel(),"cataloging-section"){
				@multicombobox(myForm,jsonMap,"language",services.ZettelFields.languageZF.getLabel(),"select-language",ResearchDataHelper.getLanguageMap(),19)
			}
			@accordionPanel(services.ZettelFields.catalogingHeaderZF.getLabel(),"cataloging-section"){
				@singleSelect(myForm,"funder",services.ZettelFields.funderZF.getLabel(),"select-funder",ResearchDataHelper.getFunderMap(),20)
			}
			
			@accordionPanel(services.ZettelFields.uploadHeaderZF.getLabel(),"upload-section"){
				@multicombobox(myForm,jsonMap,"medium",services.ZettelFields.mediumZF.getLabel(),"select-medium",ResearchDataHelper.getMediumMap(),5)
				<br/>
				@singleSelect(myForm,"yearOfCopyright",services.ZettelFields.yearOfCopyrightZF.getLabel(),"datepicker-year",ResearchDataHelper.getCopyrightYear(),7)
				<br/>
			    @multifieldLd(myForm,jsonMap,"subject",services.ZettelFields.subjectZF.getLabel(),"search",22,ArticleHelper.getSubjectLookupEndpoints())
			}	
		}
		@if(myForm.hasErrors) {
		    <div class="alert alert-error">
		        <a class="close" data-dismiss="alert">x</a>
		       
		        @if(myForm.errors.size() > 0) {
		        <h3>Das Formular enth&auml;lt noch Fehler!</h3>
		        <table class="fieldErrors">
		        <tr><th>Feldname</th><th>Fehlermeldung</th></tr>
		            @for((key, value) <- ZettelHelper.sortErrorsForResearchData(myForm.errors)) {
		            	<tr>
		               		<td style="padding-right:10px;">@ZettelHelper.etikett.getLabel(ZettelHelper.getFieldWithoutIndex(key.toString())) </td>
		               		<td>
		                    @for(err <- value) {
		                        @err.message().toString()
		                    }
		                    </td>
		                 </tr>
		            }
		         </table>
		        } else {No error returned.}
		       
		    </div>
		}
		
		<!--  workaround: add rdftype=ResearchData via hidden form --> 
		<input type="hidden" name="rdftype[0]" value="http://hbz-nrw.de/regal#ResearchData" />
		<div class="form-group row">
			<div class="col-sm-offset-8 col-sm-4">
				<input id="cancel" class="cancel btn" type="button" value="Cancel" />
				<input type="submit" value="Save" class="btn btn-success" />
			</div>
		</div>
	} 
}
