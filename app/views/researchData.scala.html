@* Copyright 2016 Jan Schnasse, hbz. Licensed under the GNU Affero General Public License *@ 

@(myForm:Form[models.ZettelModel],dataFormat:String,documentId:String,topicId:String,formType:String)
@import tags._ 
@import services._
@jsonMap=@{ZettelHelper.getJsonMap(myForm)}
@zettel("Forschungsdaten",myForm,dataFormat,documentId,topicId,formType) {
	@if(myForm.hasGlobalErrors) {
		<p class="error">@myForm.globalError.message</p>
	} 
	@helper.form(action = routes.ZettelController.postForm(ResearchData.id,dataFormat,documentId,topicId)){
		<a href="@models.ResearchData.getHelpTextUrl()" id="helpTextUrl" style="float:right" target="blank">Hilfe</a>
		@accordion(""){
			@accordionPanel(services.ZettelFields.titleHeaderEnZF.getLabel(0),"title-section"){
			    @smallTextArea(myForm,"title","Title"+"*","",1)
				<br/>
				@smallTextArea(myForm,"alternative","Alternative title","",2)
			}
			@accordionPanel(services.ZettelFields.creatorshipHeaderEnZF.getLabel(0),"creator-section"){
                @multifieldLd(myForm,jsonMap,"creator",services.ZettelFields.creatorZF.getLabel(1),"search",3,ArticleHelper.getPersonLookupEndpoints())
			    <br/>
				@multifieldLd(myForm,jsonMap,"contributor",services.ZettelFields.contributorZF.getLabel(0),"search",4,ArticleHelper.getPersonLookupEndpoints())
				<br/>
			    @multifieldLd(myForm,jsonMap,"other",services.ZettelFields.otherZF.getLabel(0),"search",5,ArticleHelper.getPersonLookupEndpoints())		    
			}
			@accordionPanel(services.ZettelFields.resourceHeaderEnZF.getLabel(0),"upload-section"){
				@singlefieldText(myForm,"issued",services.ZettelFields.issuedZF.getLabel(0)+"*","",12)
			}
			@accordionPanel(services.ZettelFields.collectionHeaderEnZF.getLabel(0),"collection-section"){
				@multifieldLd(myForm,jsonMap,"institution",services.ZettelFields.institutionZF.getLabel(0),"search",13,ArticleHelper.getInstitutionLookupEndpoints())
			}
			@accordionPanel(services.ZettelFields.uploadHeaderEnZF.getLabel(0),"upload-section"){
				@singleSelect(myForm,"medium",services.ZettelFields.mediumZF.getLabel(0),"select-medium",ResearchDataHelper.getMediumMap(),6)
				<br/>
				@singleSelect(myForm,"yearOfCopyright",services.ZettelFields.yearOfCopyrightZF.getLabel(0),"datepicker-year",ResearchDataHelper.getCopyrightYear(),7)
				<br />
				@singleSelect(myForm,"license",services.ZettelFields.licenseZF.getLabel(0),"select-license",ResearchDataHelper.getLicenseMap(),8)
				<br />
				@datepicker(myForm,"embargoTime",services.ZettelFields.embargoTimeZF.getLabel(0),"datepicker",9)
			}
			@accordionPanel(services.ZettelFields.catalogingHeaderEnZF.getLabel(0),"cataloging-section"){
				@singleSelect(myForm,"language",services.ZettelFields.languageZF.getLabel(0),"select-language",ResearchDataHelper.getLanguageMap(),10)
				<br/>
				@textArea(myForm,"description",services.ZettelFields.descriptionZF.getLabel(0),"",11)
				<br />
				@textArea(myForm,"usageManual",services.ZettelFields.usageManualZF.getLabel(0),"",12)
				<br />
				@multicombobox(myForm,jsonMap,"ddc",services.ZettelFields.ddcZF.getLabel(0)+"*","select-ddc",ResearchDataHelper.ddc,13)
				<br />
				@multifieldLd(myForm,jsonMap,"subject",services.ZettelFields.subjectZF.getLabel(0),"search",14,ArticleHelper.getSubjectLookupEndpoints())			
			}
			@accordionPanel(services.ZettelFields.fundingsHeaderEnZF.getLabel(0),"identifier-section"){
                @funderEditingWidget(myForm,jsonMap)
            }
			@accordionPanel(services.ZettelFields.observationHeaderEnZF.getLabel(0),"recording-section"){
				@multiselect(myForm,jsonMap,"dataOrigin",services.ZettelFields.dataOriginZF.getLabel(0),"select-dataOrigin",ResearchDataHelper.getDataOriginMap(),15)
				<br />
				@textArea(myForm,"recordingPeriod",services.ZettelFields.recordingPeriodZF.getLabel(0),"",16)
				<br />
				@multifieldLd(myForm,jsonMap,"recordingLocation",services.ZettelFields.recordingLocationZF.getLabel(0),"geonames-lookup",17,ResearchDataHelper.getEmptyLookupEndpoints())
				<br />
				@multifieldLd(myForm,jsonMap,"recordingCoordinates",services.ZettelFields.recordingCoordinatesZF.getLabel(0),"geonames-reverse-lookup",18,ResearchDataHelper.getEmptyLookupEndpoints())
			}
			@accordionPanel(services.ZettelFields.publicationsHeaderEnZF.getLabel(0),"link-section"){
			    @multifieldText(myForm,jsonMap,"reference",services.ZettelFields.referenceZF.getLabel(0),"",19)
				<br />
				@multifieldText(myForm,jsonMap,"associatedPublication",services.ZettelFields.associatedPublicationZF.getLabel(0),"",20)
				<br/>
				@multifieldText(myForm,jsonMap,"associatedDataset",services.ZettelFields.associatedDatasetZF.getLabel(0),"",21)
				<br/>
				@singlefieldText(myForm,"nextVersion",services.ZettelFields.nextVersionZF.getLabel(0),"",22)
				<br />	<br />
				@singlefieldText(myForm,"previousVersion",services.ZettelFields.previousVersionZF.getLabel(0),"",23)
			}
			@accordionPanel(services.ZettelFields.identifiersHeaderEnZF.getLabel(0),"identifier-section"){
				<br />
				@multifieldText(myForm,jsonMap,"urn",services.ZettelFields.urnZF.getLabel(0),"",24)
				<br />
				@multifieldText(myForm,jsonMap,"doi",services.ZettelFields.doiZF.getLabel(0),"",25)
				<br />
				@multifieldText(myForm,jsonMap,"isLike",services.ZettelFields.isLikeZF.getLabel(0),"",26)
			}
			@accordionPanel(services.ZettelFields.ktblHeaderZF.getLabel(0),"ktbl-section"){
				<br />
				@singleSelect(myForm,"livestock",services.ZettelFields.livestockZF.getLabel(0),"select-livestock",GenericDataHelper.getFieldSelectValues("ktbl.livestock.properties", "info.ktbl.livestock"),40)
				<br />
       			@singleSelect(myForm,"ventilation",services.ZettelFields.getEtikettByName("ventilationZF", "info.ktbl.ventilation@en"),"select-ventilation",GenericDataHelper.getFieldSelectValues("ktbl.livestock.properties", "info.ktbl.ventilation"),41)
       			<br />
        		@multiselect(myForm, jsonMap, "treatment", services.ZettelFields.getEtikettByName("treatmentZF", "info.ktbl.treatment@en"), "select-treatment", GenericDataHelper.getFieldSelectValues("ktbl.livestock.properties", "info.ktbl.treatment"),40)
        		<br />
				@multiselect(myForm, jsonMap, "housing", services.ZettelFields.getEtikettByName("housingZF", "info.ktbl.housing@en"), "select-housing", GenericDataHelper.getFieldSelectValues("ktbl.livestock.properties", "info.ktbl.housing"),40)
				<br />
				@multiselect(myForm, jsonMap, "treatmentdetail", services.ZettelFields.getEtikettByName("treatmentdetailZF", "info.ktbl.treatmentdetail@en"), "select-treatmentdetail", GenericDataHelper.getFieldSelectValues("ktbl.livestock.properties", "info.ktbl.treatmentdetail"),40)
				<br />
				@multiselect(myForm, jsonMap, "emissionprobe", services.ZettelFields.getEtikettByName("emissionsprobeZF", "info.ktbl.emissionprobe@en"),"select-emissionprobe",GenericDataHelper.getFieldSelectValues("ktbl.livestock.properties", "info.ktbl.emissionprobe"),42)
				<br />
				@multiselect(myForm, jsonMap, "emission", services.ZettelFields.getEtikettByName("emissionsZF", "info.ktbl.emission@en"),"select-emission",GenericDataHelper.getFieldSelectValues("ktbl.livestock.properties", "info.ktbl.emission"),42)
				<br />
				@multiselect(myForm, jsonMap, "emissionreduce", services.ZettelFields.getEtikettByName("emissionsreduceZF", "info.ktbl.emissionreduce@en"),"select-emissions",GenericDataHelper.getFieldSelectValues("ktbl.livestock.properties", "info.ktbl.emissionreduce"),43)
				<br />
				@singleSelect(myForm,"projecttitle",services.ZettelFields.projecttitleZF.getLabel(0),"select-projecttitle",GenericDataHelper.getFieldSelectValues("ktbl.livestock.properties", "info.ktbl.projecttitle"),44)
				<br />
				<!-- @singlefieldText(myForm,"citationReference",services.ZettelFields.citationReferenceZF.getLabel(0),"",45)
				<br/> -->
			}
		}
		@if(myForm.hasErrors) {
		    <div class="alert alert-error">
		        <a class="close" data-dismiss="alert">x</a>
		       
		        @if(myForm.errors.size() > 0) {
		        <h3>Das Formular enth&auml;lt noch Fehler!</h3>
		        <table class="fieldErrors">
		        <tr><th>Feldname</th><th>Fehlermeldung</th></tr>
		            @for((key, value) <- ZettelHelper.sortErrorsForResearchData(myForm.errors)) {
		            	<tr>
		               		<td style="padding-right:10px;">@ZettelHelper.etikett.getLabel(ZettelHelper.getFieldWithoutIndex(key.toString())) </td>
		               		<td>
		                    @for(err <- value) {
		                        @err.message().toString()
		                    }
		                    </td>
		                 </tr>
		            }
		         </table>
		        } else {No error returned.}
		       
		    </div>
		}
		
		<!--  workaround: add rdftype=ResearchData via hidden form --> 
		<input type="hidden" name="rdftype[0]" value="http://hbz-nrw.de/regal#ResearchData" />
		<div class="form-group row">
			<div class="col-sm-offset-8 col-sm-4">
				<input id="cancel" class="cancel btn" type="button" value="Cancel" />
				<input type="submit" value="Save" class="btn btn-success" />
			</div>
		</div>
	} 
}
