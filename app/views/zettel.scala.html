@* Copyright 2016 Jan Schnasse, hbz. Licensed under the GNU Affero General Public License *@
@(title: String)(content: Html) 
@import play.api.Play.current
<!DOCTYPE html>
<html>
<head>
<link rel="shortcut icon" href="/public/images/favicon.ico"
	type="image/x-icon" />
<link rel="stylesheet" media="screen"
	href="@controllers.routes.Assets.versioned("stylesheets/main.css")">
<link rel="stylesheet" media="screen"
	href="@controllers.routes.Assets.versioned("stylesheets/bootstrap.min.css")">
<link rel="stylesheet" media="screen"
	href="@controllers.routes.Assets.versioned("stylesheets/octicons.css")">
<link rel="shortcut icon" type="image/png"
	href="@controllers.routes.Assets.versioned("images/favicon.png")">
<link rel="stylesheet" href="@controllers.routes.Assets.versioned("stylesheets/font-awesome.min.css")">
<link rel="stylesheet" href="@controllers.routes.Assets.versioned("stylesheets/jquery-ui.css")">
<script src="@controllers.routes.Assets.versioned("javascripts/jquery-1.10.2.min.js")"></script>
<script src="@controllers.routes.Assets.versioned("javascripts/jquery-ui.min.js")"></script>
<script src="@controllers.routes.Assets.versioned("javascripts/bootstrap.min.js")"></script>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE10">


</head>
<body>

	<div class="container col-sd-12">
		<h1>@title</h1>
		@content
		</div>
	</div>
	@if(flash.containsKey("success")) {
  <div class="well">
    <div id="success-message" class="text-success">
      @flash.get("success")
    </div>
  </div>
  }
  @if(flash.containsKey("error")) {
  <div class="well">
    <div id="error-message" class="text-danger">
      @flash.get("error")
  </div>
</div>
}
</body>
	<script>
		enableAllGndAutocompletion();
		addActionsToRemoveAndAddButtons();
		
		function enableAllGndAutocompletion(){
			$('input.gnd-person-search').each(function() {
				enableGndPersonAutocompletion($(this));
		    });
			$('input.gnd-subject-search').each(function() {
				enableGndSubjectAutocompletion($(this));
		    });
		}
		function enableGndPersonAutocompletion(inputElement){
			inputElement.autocomplete({
				select: function (event, ui) {
				      this.value = ui.item.value;
				      $(this).siblings(".input-field-heading").html("<b>"+ui.item.label+"</b>("+ui.item.value+")");				     
				      return false;
				   },
	            source : function(request, response) {
	                $.ajax({
	                    url : "http://api.lobid.org/person",
	                    dataType : "jsonp",
	                    data : {
	                        name : request.term,
	                        format : "ids"
	                    },
	                    success : function(data) {
	                        response(data);
	                    }
	                });
	            }		        	
	        });
		}
		function enableGndSubjectAutocompletion(inputElement){
			inputElement.autocomplete({
				select: function (event, ui) {
				      this.value = ui.item.value;
				      $(this).siblings(".input-field-heading").html("<b>"+ui.item.label+"</b>("+ui.item.value+")");				     
				      return false;
				   },
	            source : function(request, response) {
	                $.ajax({
	                    url : "http://api.lobid.org/subject",
	                    dataType : "jsonp",
	                    data : {
	                        name : request.term,
	                        format : "ids"
	                    },
	                    success : function(data) {
	                        response(data);
	                    }
	                });
	            }		        	
	        });
		}
		function destroyGndAutocompletion(){
			$('input.gnd-person-search').each(function() {
		        $(this).autocomplete('destroy');
		        $(this).removeData('autocomplete');
			});
			$('input.gnd-subject-search').each(function() {
		        $(this).autocomplete('destroy');
		        $(this).removeData('autocomplete');
			});
		}
		function resetIds(curFieldName){
			 var num = 0;
			 $('input[name^='+curFieldName+']').each(function() {
				 console.log(curFieldName);
				 $(this).attr('name',curFieldName+"["+num+"]");
				 $(this).attr('id',curFieldName+"_"+num);
				 num++;
			 });
		}
		function addActionsToRemoveAndAddButtons(){
			$('.multi-field-wrapper').each(function() {
			    var $wrapper = $('.multi-fields', this);
	 		    var curFieldName = $('.multi-fields', this).attr('id');
			    $(".add-field", $(this)).click(function(e) {
			    	destroyGndAutocompletion();
			        var newField = $('.multi-field:first-child', $wrapper).clone(true);  
			        newField.appendTo($wrapper).find('input').val('').focus();
			        resetIds(curFieldName);
			        $(newField).find(".input-field-heading").html("");
			        enableAllGndAutocompletion();	      
			    });
			    $('.multi-field .remove-field', $wrapper).click(function() {
			        if ($('.multi-field', $wrapper).length > 1)
			            $(this).parents('.multi-field').remove();
			        	resetIds(curFieldName);
			    });
			    $('.multi-field .moveUp', $wrapper).click(function() {
			    	var $el=$(this).parents(".multi-field");
			    	 if ($el.not(':first-child')){
			    		    $el.prev().before($el);
			    		    resetIds(curFieldName);
			    	 }
			    });
			    $('.multi-field .moveDown', $wrapper).click(function() {
			    	var $el=$(this).parents(".multi-field");
			    	 if ($el.not(':last-child')){
			    		    $el.next().after($el);
			    		    resetIds(curFieldName);
			    	 }
			    });
			    
			});
		}
	
		$(function() {
			    $(".datepicker").datepicker();
		 });
		$(function() {
		    $(".datepicker-year").datepicker({ dateFormat: 'yy'});
	 	});
	</script>
</html>
