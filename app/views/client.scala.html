@* Copyright 2016 Jan Schnasse, hbz. Licensed under the GNU Affero General Public License *@
@(heading:String,myFormat:String,formId:String,documentId:String,topicId:String)
@import play.api.Play.current
@context=@{play.api.Play.configuration.getString("play.http.context").getOrElse("")}

<!DOCTYPE html>
<html>
<head>
<script src="@controllers.routes.Assets.versioned("javascripts/jquery-1.10.2.min.js")"></script>
<style>
.success, .warning, .data {
	border: 1px solid;
	margin: 10px 0px;
	padding: 15px 10px 15px 50px;
	visibility: hidden;
}

.success {
	color: #4F8A10;
	background-color: #DFF2BF;
}

.warning {
	color: #D8000C;
	background-color: #FFBABA;
}
</style>
<script>
	function onSuccess(data) {
		jQuery('#successBox').html(data);
		jQuery('#successBox').css('visibility', 'visible');
		jQuery('#warningBox').css('visibility', 'hidden');
	}
	function onFail(data) {
		jQuery('#warningBox').html(data);
		jQuery('#warningBox').css('visibility', 'visible');
		jQuery('#successBox').css('visibility', 'hidden');
	}
	function getMessage(e) {
		var obj = JSON.parse(e);
		if (obj.code == 200) {
			onSuccess(decodeURI(JSON.stringify(obj.message)));
		} else {
			onFail(JSON.stringify(obj.message));
		}
	}

	function handleMessage(e) {	
 		 if (e.data.action == 'establishConnection'){
 		  var topicId=e.data.topicId;
 		  var documentId=e.data.documentId;
 		  var iframe = document.getElementById("iFrame");
 		  var target =  iframe.contentWindow || iframe;	
 		  
 		  //push here your rdf string to send it to zettel 		  
	      var rdf = $('#rdfBox').text();
 		  if (typeof rdf != "undefined") {
				target.postMessage({
					'queryParam' : 'id=katalog:data&format=xml&topicId='
							+ topicId + '&documentId=' + documentId,
					'message' : rdf,
					'action'  : 'postDataToZettel'
				}, "*");
			}
		} else if (e.data.action == 'resize') {
			var targetHeight = e.data.message;
			jQuery('#iFrame').height(targetHeight);
		} else if (e.data.action == 'postData') {
			getMessage(e.data.message);
		}
	}

	function getRdf(){
		return '<?xml version="1.0" encoding="UTF-8"?> <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"> <rdf:Description rdf:nodeID="b0"> <rdf:first rdf:resource="http://dewey.info/class/640/"/> <rdf:rest rdf:nodeID="b1"/> </rdf:Description> <rdf:Description rdf:nodeID="b1"> <rdf:first rdf:resource="http://dewey.info/class/660/"/> <rdf:rest rdf:nodeID="b2"/> </rdf:Description> <rdf:Description rdf:nodeID="b2"> <rdf:first rdf:resource="http://dewey.info/class/610/"/> <rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/> </rdf:Description> <rdf:Description rdf:nodeID="b3"> <rdf:first rdf:resource="http://d-nb.info/gnd/183657829"/> <rdf:rest rdf:resource="http://www.w3.org/1999/02/22-rdf-syntax-ns#nil"/> </rdf:Description> <rdf:Description rdf:about="frl:96"> <accessScheme xmlns="http://hbz-nrw.de/regal#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">private</accessScheme> <contentType xmlns="http://hbz-nrw.de/regal#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">researchData</contentType> <dataOrigin xmlns="http://hbz-nrw.de/regal#" rdf:resource="http://hbz-nrw.de/regal#Probe"/> <ddc xmlns="http://hbz-nrw.de/regal#" rdf:nodeID="b0"/> <license xmlns="http://hbz-nrw.de/regal#" rdf:resource="https://creativecommons.org/licenses/by/4.0"/> <professionalGroup xmlns="http://hbz-nrw.de/regal#" rdf:resource="http://d-nb.info/gnd/4006851-1"/> <publishScheme xmlns="http://hbz-nrw.de/regal#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">public</publishScheme> <associatedDataset xmlns="http://hbz-nrw.de/regal#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">d1</associatedDataset> <associatedDataset xmlns="http://hbz-nrw.de/regal#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">d2</associatedDataset><yearOfCopyright xmlns="http://hbz-nrw.de/regal#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">2016</yearOfCopyright> <abstract xmlns="http://purl.org/dc/terms/" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Abstracts können in vieler Hinsicht verwendet werden – zum Beispiel zur Feststellung von Relevanz: Es soll schnell und exakt zu erkennen sein, ob das Dokument für die Fragestellung relevant ist und der Leser das Originaldokument noch lesen muss. Weiterhin dient es zur Informationsgewinnung: Das Abstract soll die wesentlichen Informationen liefern, auch ohne dass das Originaldokument gelesen werden muss. Auch für Forschungsberichte und Ähnliches sind Abstracts nützlich: Sie können teilweise der Öffentlichkeit zugänglich gemacht werden, falls dies beim Originaldokument nicht möglich ist.&#xD; &#xD; Üblicherweise müssen wissenschaftliche Artikel ein Abstract enthalten, typischerweise von 100 bis 150 Wörtern, ohne Bilder und Literaturzitate und in einem Absatz. Bei Konferenzen wird in der Regel verlangt, ein Abstract einzureichen, damit das wissenschaftliche Organisationsteam entscheiden kann, welche der gewünschten Vorträge zugelassen werden. Diese Abstracts sind in der Regel etwas länger und können häufig Bilder, Literaturzitate auf bis zu einer DIN-A4-Seite enthalten.</abstract> <creator xmlns="http://purl.org/dc/terms/" rdf:nodeID="b3"/> <language xmlns="http://purl.org/dc/terms/" rdf:resource="http://id.loc.gov/vocabulary/iso639-2/eng"/> <medium xmlns="http://purl.org/dc/terms/" rdf:resource="http://purl.org/ontology/bibo/Image"/> <title xmlns="http://purl.org/dc/terms/" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">achso</title> <itemID xmlns="http://www.openarchives.org/OAI/2.0/" rdf:resource="oai:api.localhost:frl:96"/> <isDescribedBy xmlns="http://www.openarchives.org/ore/terms/" rdf:resource="frl:96.rdf"/> <rdf:type rdf:resource="http://hbz-nrw.de/regal#ResearchData"/> <primaryTopic xmlns="http://xmlns.com/foaf/0.1/" rdf:resource="frl:96"/> </rdf:Description> <rdf:Description rdf:about="frl:96.rdf"> <createdBy xmlns="http://hbz-nrw.de/regal#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">1</createdBy> <objectTimestamp xmlns="http://hbz-nrw.de/regal#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">2016-06-30T11:51:05.910+0000</objectTimestamp> <created xmlns="http://purl.org/dc/terms/" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">2016-06-29T14:20:23.566+0000</created> <modified xmlns="http://purl.org/dc/terms/" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">2016-06-30T11:51:05.910+0000</modified> <describes xmlns="http://www.openarchives.org/ore/terms/" rdf:resource="frl:96"/> </rdf:Description> <rdf:Description rdf:about="http://d-nb.info/gnd/107218592X"> <prefLabel xmlns="http://www.w3.org/2004/02/skos/core#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">http://d-nb.info/gnd/107218592X</prefLabel> </rdf:Description> <rdf:Description rdf:about="http://d-nb.info/gnd/183657829"> <preferredName xmlns="http://d-nb.info/standards/elementset/gnd#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Testik, Ahmet</preferredName> <preferredNameForThePerson xmlns="http://d-nb.info/standards/elementset/gnd#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Testik, Ahmet</preferredNameForThePerson> <rdf:type rdf:resource="http://d-nb.info/standards/elementset/gnd#DifferentiatedPerson"/> <rdf:type rdf:resource="http://d-nb.info/standards/elementset/gnd#UndifferentiatedPerson"/> <prefLabel xmlns="http://www.w3.org/2004/02/skos/core#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Testik, Ahmet</prefLabel> </rdf:Description> <rdf:Description rdf:about="http://d-nb.info/gnd/4006851-1"> <preferredNameForTheSubjectHeading xmlns="http://d-nb.info/standards/elementset/gnd#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Biologie</preferredNameForTheSubjectHeading> <prefLabel xmlns="http://www.w3.org/2004/02/skos/core#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Biologie</prefLabel> </rdf:Description> <rdf:Description rdf:about="http://dewey.info/class/610/"> <prefLabel xmlns="http://www.w3.org/2004/02/skos/core#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Medizin und Gesundheit</prefLabel> </rdf:Description> <rdf:Description rdf:about="http://dewey.info/class/640/"> <prefLabel xmlns="http://www.w3.org/2004/02/skos/core#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Hauswirtschaft und Familie</prefLabel> </rdf:Description> <rdf:Description rdf:about="http://dewey.info/class/660/"> <prefLabel xmlns="http://www.w3.org/2004/02/skos/core#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Chemische Verfahrenstechnik</prefLabel> </rdf:Description> <rdf:Description rdf:about="http://hbz-nrw.de/regal#Probe"> <prefLabel xmlns="http://www.w3.org/2004/02/skos/core#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">http://hbz-nrw.de/regal#Probe</prefLabel> </rdf:Description> <rdf:Description rdf:about="http://hbz-nrw.de/regal#ResearchData"> <prefLabel xmlns="http://www.w3.org/2004/02/skos/core#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Forschungsdaten</prefLabel> </rdf:Description> <rdf:Description rdf:about="http://id.loc.gov/vocabulary/iso639-2/eng"> <prefLabel xmlns="http://www.w3.org/2004/02/skos/core#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">http://id.loc.gov/vocabulary/iso639-2/eng</prefLabel> </rdf:Description> <rdf:Description rdf:about="http://purl.org/ontology/bibo/Image"> <prefLabel xmlns="http://www.w3.org/2004/02/skos/core#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">Bild</prefLabel> </rdf:Description> <rdf:Description rdf:about="https://creativecommons.org/licenses/by/4.0"> <prefLabel xmlns="http://www.w3.org/2004/02/skos/core#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">https://creativecommons.org/licenses/by/4.0</prefLabel> </rdf:Description> <rdf:Description rdf:about="oai:api.localhost:frl:96"> <prefLabel xmlns="http://www.w3.org/2004/02/skos/core#" rdf:datatype="http://www.w3.org/2001/XMLSchema#string">oai:api.localhost:frl:96</prefLabel> </rdf:Description> </rdf:RDF>';
	}
	$(function() {
	window.addEventListener("message", handleMessage, false);
	$('#rdfBox').text(encodeURI(getRdf()));
	});
</script>
</head>
<body>
	<div id="successBox" class="success"></div>
	<div id="warningBox" class="warning"></div>
	<div id="rdfBox" class="data" style="display:none;"></div>
	<iframe
		src="/tools/zettel/forms?id=@formId&format=@myFormat&documentId=@documentId&topicId=@topicId"
		width="100%" style="border: none;" id="iFrame">
		<p>iframes are not supported by your browser.</p>
	</iframe>

</body>

</html>
